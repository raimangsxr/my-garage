<div class="profile-container">
    <h2>Edit Profile</h2>

    <div class="current-profile">
        <img [src]="form.get('image_url')?.value || 'assets/images/default-avatar.png'" class="profile-preview"
            alt="Profile">
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()">

        <!-- Image Selection Section -->
        <div class="image-section">
            <h3>Profile Image</h3>

            <!-- Pre-defined Avatars -->
            <div class="avatars-grid">
                <img *ngFor="let avatar of avatars" [src]="avatar" (click)="selectAvatar(avatar)"
                    [class.selected]="form.get('image_url')?.value === avatar" class="avatar-option">
            </div>

            <div class="upload-controls">
                <button type="button" mat-stroked-button (click)="fileInput.click()">
                    <mat-icon>upload</mat-icon> Upload Image
                </button>
                <input #fileInput type="file" (change)="onFileSelected($event)" accept="image/*" hidden>

                <mat-form-field appearance="outline" class="url-input">
                    <mat-label>Or Image URL</mat-label>
                    <input matInput #urlInput (blur)="onUrlInput(urlInput.value)" placeholder="https://...">
                    <button mat-icon-button matSuffix (click)="onUrlInput(urlInput.value)">
                        <mat-icon>check</mat-icon>
                    </button>
                </mat-form-field>
            </div>

            <!-- Cropper Area -->
            <div class="cropper-container" *ngIf="isCropping">
                <p>Drag image to center</p>
                <canvas #canvas (mousedown)="onMouseDown($event)" (mousemove)="onMouseMove($event)"
                    (mouseup)="onMouseUp()" (mouseleave)="onMouseUp()">
                </canvas>
                <div class="cropper-actions">
                    <button type="button" mat-stroked-button class="cancel-btn" (click)="cancelCrop()">Cancel</button>
                    <button type="button" mat-raised-button color="primary" (click)="confirmCrop()">Use This
                        Image</button>
                </div>
            </div>
        </div>

        <!-- User Details -->
        <div class="details-section">
            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Full Name</mat-label>
                <input matInput formControlName="full_name">
                <mat-error *ngIf="form.get('full_name')?.hasError('required')">Full name is required</mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Email</mat-label>
                <input matInput [value]="user?.email" disabled>
                <mat-hint>Email cannot be changed</mat-hint>
            </mat-form-field>
        </div>

        <div class="actions">
            <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">
                Save Changes
            </button>
        </div>
    </form>
</div>
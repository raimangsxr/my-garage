<h2 mat-dialog-title>{{ isEditMode ? 'Edit Maintenance' : 'New Maintenance' }}</h2>

<mat-dialog-content>
    <div class="dialog-layout">
        <!-- Left Column: Maintenance Details -->
        <div class="column main-details">
            <form [formGroup]="form">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Vehicle</mat-label>
                    <mat-select formControlName="vehicle_id">
                        <mat-option *ngFor="let vehicle of vehicles" [value]="vehicle.id">
                            {{ vehicle.brand }} {{ vehicle.model }} ({{ vehicle.license_plate }})
                        </mat-option>
                    </mat-select>
                    <mat-error *ngIf="form.get('vehicle_id')?.hasError('required')">
                        Vehicle is required
                    </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Date</mat-label>
                    <input matInput [matDatepicker]="picker" formControlName="date">
                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                    <mat-datepicker #picker></mat-datepicker>
                    <mat-error *ngIf="form.get('date')?.hasError('required')">
                        Date is required
                    </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Description</mat-label>
                    <textarea matInput formControlName="description" rows="3"></textarea>
                    <mat-error *ngIf="form.get('description')?.hasError('required')">
                        Description is required
                    </mat-error>
                </mat-form-field>

                <div class="row">
                    <mat-form-field appearance="outline">
                        <mat-label>Mileage (km)</mat-label>
                        <input matInput type="number" formControlName="mileage">
                        <mat-error *ngIf="form.get('mileage')?.hasError('required')">
                            Mileage is required
                        </mat-error>
                    </mat-form-field>

                    <mat-form-field appearance="outline">
                        <mat-label>Cost (€)</mat-label>
                        <input matInput type="number" formControlName="cost">
                        <mat-error *ngIf="form.get('cost')?.hasError('required')">
                            Cost is required
                        </mat-error>
                    </mat-form-field>
                </div>

                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Service Provider</mat-label>
                    <mat-select formControlName="supplier_id">
                        <mat-option [value]="null">- None -</mat-option>
                        <mat-option *ngFor="let supplier of suppliers" [value]="supplier.id">
                            {{ supplier.name }}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </form>
        </div>

        <!-- Right Column: Related Entities -->
        <div class="column related-entities">
            <!-- Parts Section -->
            <div class="section">
                <div class="section-header">
                    <h3>Parts</h3>
                    <button mat-icon-button color="primary" (click)="addPart()" [disabled]="!isEditMode"
                        matTooltip="Save maintenance first to add parts">
                        <mat-icon>add</mat-icon>
                    </button>
                </div>
                <div class="entity-list">
                    <div class="entity-item" *ngFor="let part of parts">
                        <div class="item-info">
                            <span class="item-name">{{ part.name }}</span>
                            <span class="item-sub">{{ part.reference }}</span>
                        </div>
                        <div class="item-actions">
                            <span class="item-price">{{ part.price | number:'1.2-2' }}€</span>
                            <button mat-icon-button color="warn" (click)="deletePart(part.id!)"
                                matTooltip="Delete part">
                                <mat-icon>remove_circle</mat-icon>
                            </button>
                        </div>
                    </div>
                    <div class="empty-text" *ngIf="parts.length === 0">
                        {{ isEditMode ? 'No parts added' : 'Save to add parts' }}
                    </div>
                </div>
            </div>

            <!-- Invoices Section -->
            <div class="section">
                <div class="section-header">
                    <h3>Invoices</h3>
                </div>
                <div class="entity-list">
                    <div class="entity-item" *ngFor="let invoice of invoices">
                        <div class="item-info">
                            <span class="item-name">#{{ invoice.number }}</span>
                            <span class="item-sub">{{ invoice.date | date:'dd/MM/yyyy' }}</span>
                        </div>
                        <span class="item-price">{{ invoice.amount | number:'1.2-2' }}€</span>
                    </div>
                    <div class="empty-text" *ngIf="invoices.length === 0">
                        No invoices linked
                    </div>
                </div>
            </div>
        </div>
    </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-button (click)="onCancel()">Cancel</button>
    <button mat-raised-button color="primary" (click)="onSave()" [disabled]="form.invalid">Save</button>
</mat-dialog-actions>
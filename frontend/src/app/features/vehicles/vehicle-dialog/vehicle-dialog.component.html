<h2 mat-dialog-title>{{ isEditMode ? 'Edit Vehicle' : 'Add Vehicle' }}</h2>
<mat-dialog-content>
    <form [formGroup]="form" class="vehicle-form">
        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Brand</mat-label>
                <input matInput formControlName="brand" placeholder="e.g. Toyota">
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Model</mat-label>
                <input matInput formControlName="model" placeholder="e.g. Corolla">
            </mat-form-field>
        </div>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Year</mat-label>
                <input matInput type="number" formControlName="year">
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>License Plate</mat-label>
                <input matInput formControlName="license_plate">
            </mat-form-field>
        </div>

        <div class="image-upload-section">
            <h3>Vehicle Image</h3>

            <mat-form-field appearance="outline" class="full-width">
                <mat-label>Image Source</mat-label>
                <mat-select [(value)]="imageSource" (selectionChange)="onImageSourceChange()">
                    <mat-option value="file">Upload from Computer</mat-option>
                    <mat-option value="url">Load from URL</mat-option>
                </mat-select>
            </mat-form-field>

            <div *ngIf="imageSource === 'file'">
                <input type="file" accept="image/*" (change)="onFileSelected($event)" #fileInput style="display: none">
                <button mat-raised-button type="button" (click)="fileInput.click()">
                    Choose Image
                </button>
            </div>

            <div *ngIf="imageSource === 'url'" class="url-input-section">
                <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Image URL</mat-label>
                    <input matInput [(ngModel)]="imageUrl" [ngModelOptions]="{standalone: true}"
                        placeholder="https://example.com/car.jpg">
                </mat-form-field>
                <button mat-raised-button type="button" (click)="loadImageFromUrl()"
                    [disabled]="!imageUrl || imageUrl.trim() === ''">
                    Load Image
                </button>
            </div>

            <div *ngIf="imagePreview" class="image-preview">
                <img [src]="imagePreview" alt="Vehicle preview">
            </div>
        </div>

        <h3>Dates & Amounts</h3>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Next ITV Date</mat-label>
                <input matInput [matDatepicker]="itvPicker" formControlName="next_itv_date">
                <mat-datepicker-toggle matIconSuffix [for]="itvPicker"></mat-datepicker-toggle>
                <mat-datepicker #itvPicker></mat-datepicker>
            </mat-form-field>
        </div>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Next Insurance Date</mat-label>
                <input matInput [matDatepicker]="insPicker" formControlName="next_insurance_date">
                <mat-datepicker-toggle matIconSuffix [for]="insPicker"></mat-datepicker-toggle>
                <mat-datepicker #insPicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Last Insurance Amount (€)</mat-label>
                <input matInput type="number" formControlName="last_insurance_amount">
            </mat-form-field>
        </div>

        <div class="form-row">
            <mat-form-field appearance="outline">
                <mat-label>Next Road Tax Date</mat-label>
                <input matInput [matDatepicker]="taxPicker" formControlName="next_road_tax_date">
                <mat-datepicker-toggle matIconSuffix [for]="taxPicker"></mat-datepicker-toggle>
                <mat-datepicker #taxPicker></mat-datepicker>
            </mat-form-field>
            <mat-form-field appearance="outline">
                <mat-label>Last Road Tax Amount (€)</mat-label>
                <input matInput type="number" formControlName="last_road_tax_amount">
            </mat-form-field>
        </div>

        <div class="specs-section" formGroupName="specs">
            <h3>Specifications</h3>
            <mat-accordion multi>
                <!-- General Info -->
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>General Information</mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>VIN (Vehicle Identification Number)</mat-label>
                            <input matInput formControlName="vin" placeholder="17-character code">
                        </mat-form-field>
                    </div>
                    <div class="form-row">
                        <mat-form-field appearance="outline">
                            <mat-label>Color</mat-label>
                            <input matInput formControlName="color" placeholder="e.g. Pearl White">
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Color Code</mat-label>
                            <input matInput formControlName="color_code" placeholder="e.g. 070">
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Engine & Transmission -->
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Engine & Transmission</mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="form-row">
                        <mat-form-field appearance="outline">
                            <mat-label>Engine Type</mat-label>
                            <input matInput formControlName="engine_type" placeholder="e.g. V6 3.5L">
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Fuel Type</mat-label>
                            <mat-select formControlName="fuel_type">
                                <mat-option value="Petrol">Petrol</mat-option>
                                <mat-option value="Diesel">Diesel</mat-option>
                                <mat-option value="Hybrid">Hybrid</mat-option>
                                <mat-option value="Electric">Electric</mat-option>
                                <mat-option value="LPG">LPG</mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="form-row">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Transmission</mat-label>
                            <input matInput formControlName="transmission" placeholder="e.g. Automatic 6-speed">
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>

                <!-- Fluids & Consumables -->
                <mat-expansion-panel>
                    <mat-expansion-panel-header>
                        <mat-panel-title>Fluids & Consumables</mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="form-row">
                        <mat-form-field appearance="outline">
                            <mat-label>Engine Oil Type</mat-label>
                            <input matInput formControlName="engine_oil_type" placeholder="e.g. 5W-30">
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Coolant Type</mat-label>
                            <input matInput formControlName="coolant_type" placeholder="e.g. G12+">
                        </mat-form-field>
                    </div>
                    <div class="form-row">
                        <mat-form-field appearance="outline">
                            <mat-label>Battery Type</mat-label>
                            <input matInput formControlName="battery_type" placeholder="e.g. 12V 70Ah">
                        </mat-form-field>
                        <mat-form-field appearance="outline">
                            <mat-label>Tire Size</mat-label>
                            <input matInput formControlName="tire_size" placeholder="e.g. 225/45 R17">
                        </mat-form-field>
                    </div>
                </mat-expansion-panel>
            </mat-accordion>
        </div>
    </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="form.invalid">Save</button>
</mat-dialog-actions>